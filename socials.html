<!DOCTYPE html>
<head>
    <title>Socials</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" href="img/icon.jpg" type="image/x-icon" />
</head>
<body style="overflow: hidden;">
    <h1>Зв'язок зі мною</h1>
    <table align="center">
        <tr>
            <th>
                <button class="footer-button" style="margin: 2px" onclick="window.open('https://t.me/bloodbern', '_blank')">My Telegram</button>
            </th>
        </tr>
        <tr>
            <th>
                <button class="footer-button" style="margin: 2px" onclick="window.open('https://instagram.com/bloodbern', '_blank')">My Instagram</button>
            </th>
        </tr>
        <tr>
            <th>
                <button class="footer-button" style="margin: 2px" onclick="window.open('mailto:bloodbern09@gmail.com', '_blank')">Напишіть мені!</button><br>
            </th>
            <th>
                <button class="footer-button" style="margin: 2px" onclick="startGame()">Shall we play a game? :)</button><br>
            </th>
        </tr>
    </table>
    <div id="game">
        <div id="food-items-container"></div>
        <div id="chopsticks-container">
            <div class="chopstick"></div>
            <div class="chopstick">
                <div id="chopsticks-hitbox"></div>
            </div>
        </div>
    </div>
    <script>
        const gravity = 2;
        const horizontalDamping = 1.03;
        const terminalVelocity = 50;

        const spawnInterval = 2000;

        const game = document.getElementById("game");
        const foodItemsContainer = document.getElementById("food-items-container");
        const chopsticksContainer = document.getElementById("chopsticks-container");
        const chopsticksHitbox = document.getElementById("chopsticks-hitbox");

        const chopsticks = chopsticksContainer.children;
        let foodItems = [];
        let caughtFoodItem = null;

        function startGame() {
            setInterval(() => {
                for (const foodItem of foodItems) {
                    if(foodItem === caughtFoodItem) {
                        continue;
                    }

                    foodItem.move();
                }
            }, 16.666666);

            setInterval(() => {
                const foodItem = new FoodItem();

                foodItem.spawn();
            }, spawnInterval);

            game.classList.add("running");
        }

        class FoodItem {
            constructor() {
                const images = [
                    "https://cdn-icons-png.flaticon.com/512/3259/3259041.png",
                    "https://cdn-icons-png.flaticon.com/512/2515/2515345.png",
                    "https://cdn-icons-png.flaticon.com/512/2718/2718224.png",
                    "https://cdn-icons-png.flaticon.com/512/3361/3361870.png",
                    "https://cdn-icons-png.flaticon.com/512/2713/2713962.png"
                ].toSorted(() => 0.5 - Math.random());

                const width = 80;

                const image = document.createElement("img");
                image.classList.add("game-food-item");
                image.src = images[0];
                image.style.width = `${width}px`;
                image.style.top = `${Math.random() * (foodItemsContainer.clientHeight / 2)}px`; 

                this.image = image;

                this.size = width;

                this.velocity = {
                    x: 5 + Math.random() * 20,
                    y: -10 - (Math.random() * 20)
                };
                this.previousGrabPosition = {
                    x: 0,
                    y: 0
                };
            }

            spawn() {
                foodItemsContainer.appendChild(this.image);
                foodItems.push(this);
            }

            move() {
                this.image.style.left = `${this.image.offsetLeft + this.velocity.x}px`;
                this.image.style.top = `${this.image.offsetTop + this.velocity.y}px`;

                this.velocity.x /= horizontalDamping;
                this.velocity.y = Math.min(this.velocity.y + gravity, terminalVelocity);

                this.tryDespawn();
            }

            setPosition(x, y) {
                this.image.style.left = `${x - this.size / 2}px`;
                this.image.style.top = `${y - this.size / 2}px`;

                const newGrabPosition = {
                    x: this.image.offsetLeft,
                    y: this.image.offsetTop
                };

                this.velocity = {
                    x: newGrabPosition.x - this.previousGrabPosition.x,
                    y: newGrabPosition.y - this.previousGrabPosition.y
                };

                this.previousGrabPosition = newGrabPosition;

                this.tryDespawn();
            }

            tryDespawn() {
                if(this.image.offsetTop < game.clientHeight) {
                    return;
                }

                this.despawn();
            }

            despawn() {
                foodItemsContainer.removeChild(this.image);
                foodItems = foodItems.filter(foodItem => foodItem !== this);
            }

            catch(x, y) {
                this.setPosition(x, y);

                this.velocity = {
                    x: 0,
                    y: 0
                };

                caughtFoodItem = this;
            }

            release() {
                caughtFoodItem = null;
            }
        }

        game.addEventListener("mousemove", event => {
            for (const chopstick of chopsticks) {
                chopstick.style.left = `${event.clientX}px`;
                chopstick.style.top = `${event.clientY}px`;
            }

            caughtFoodItem?.setPosition(event.clientX, event.clientY);
        });

        game.addEventListener("mouseenter", event => {
            game.style.cursor = "none";
        });

        game.addEventListener("mouseleave", event => {
            game.style.cursor = null;
        });

        game.addEventListener("mousedown", event => {
            chopsticks.item(0).classList.add("grab");

            const hitboxRect = chopsticksHitbox.getBoundingClientRect();

            for (const foodItem of foodItems) {
                const foodItemRect = foodItem.image.getBoundingClientRect();

                if(hitboxRect.right < foodItemRect.left ||
                    hitboxRect.left > foodItemRect.right ||
                    hitboxRect.bottom < foodItemRect.top ||
                    hitboxRect.top > foodItemRect.bottom) {

                    continue;
                }

                foodItem.catch(event.clientX, event.clientY);
            }
        });

        game.addEventListener("mouseup", event => {
            chopsticks.item(0).classList.remove("grab");

            caughtFoodItem?.release(event.movementX, event.movementY);
        });
    </script>
</body>